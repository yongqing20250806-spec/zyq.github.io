<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>我的自动同步相册 - 灯箱版</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <style>
        body {
            margin: 0;
            overflow-x: hidden;
            background-color: #0f172a;
            color: white;
            font-family: 'PingFang SC', 'Microsoft YaHei', sans-serif;
        }
        #canvas-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            z-index: -1;
        }
        .glass-card {
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(12px);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 1.5rem;
            transition: all 0.3s ease;
        }
        .photo-card {
            overflow: hidden;
            border-radius: 1rem;
            aspect-ratio: 1 / 1;
            position: relative;
            cursor: pointer;
        }
        .photo-card img {
            width: 100%;
            height: 100%;
            object-fit: cover;
            transition: transform 0.5s ease;
        }
        .photo-card:hover img {
            transform: scale(1.1);
        }
        .photo-overlay {
            position: absolute;
            inset: 0;
            background: linear-gradient(to top, rgba(0,0,0,0.7), transparent);
            opacity: 0;
            transition: opacity 0.3s ease;
            display: flex;
            align-items: flex-end;
            padding: 1rem;
        }
        .photo-card:hover .photo-overlay {
            opacity: 1;
        }
        .gradient-text {
            background: linear-gradient(90deg, #60a5fa, #a78bfa, #f472b6);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }
        /* 加载动画 */
        .loader {
            border: 3px solid rgba(255,255,255,0.1);
            border-radius: 50%;
            border-top: 3px solid #60a5fa;
            width: 24px;
            height: 24px;
            animation: spin 1s linear infinite;
        }
        @keyframes spin { 0% { transform: rotate(0deg); } 100% { transform: rotate(360deg); } }

        /* 灯箱样式 */
        #lightbox {
            display: none;
            position: fixed;
            inset: 0;
            z-index: 100;
            background: rgba(0, 0, 0, 0.9);
            backdrop-filter: blur(8px);
            justify-content: center;
            align-items: center;
            opacity: 0;
            transition: opacity 0.3s ease;
        }
        #lightbox.active {
            display: flex;
            opacity: 1;
        }
        #lightbox-img {
            max-width: 90%;
            max-height: 85vh;
            border-radius: 0.5rem;
            box-shadow: 0 25px 50px -12px rgba(0, 0, 0, 0.5);
            transform: scale(0.9);
            transition: transform 0.3s ease;
        }
        #lightbox.active #lightbox-img {
            transform: scale(1);
        }
    </style>
</head>
<body>

    <div id="canvas-container"></div>

    <!-- 灯箱容器 (已移除文件名显示部分) -->
    <div id="lightbox" onclick="closeLightbox()">
        <button class="absolute top-6 right-6 text-white text-4xl hover:text-gray-300 transition">&times;</button>
        <img id="lightbox-img" src="" alt="放大预览" onclick="event.stopPropagation()">
    </div>

    <main class="relative z-10 min-h-screen flex flex-col items-center px-4 py-12">
        
        <section class="max-w-4xl w-full text-center mb-16 mt-10">
            <h1 class="text-4xl md:text-6xl font-bold mb-4">记录 <span class="gradient-text">生活瞬间</span></h1>
            <p class="text-lg md:text-xl text-gray-300">欢迎来到我的私人角落，这里存放着我热爱的影像与记忆。</p>
        </section>

        <section class="max-w-6xl w-full mb-20">
            <h2 class="text-2xl font-bold mb-8 flex items-center gap-2">
                <span class="w-8 h-1 bg-blue-500 rounded-full"></span>
                我的相册
                <div id="api-loader" class="loader ml-2 hidden"></div>
            </h2>
            
            <div id="photo-grid" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 gap-6">
                <!-- 图片由 JavaScript 自动抓取 -->
            </div>
        </section>

        <footer class="mt-20 text-gray-500 text-xs">
            Powered by GitHub API & Three.js
        </footer>
    </main>

    <script>
        // --- 1. 配置信息 ---
        const GITHUB_CONFIG = {
            username: 'yongqing20250806-spec',
            repo: 'zyq.github.io',
            folder: 'images'
        };

        // --- 2. 灯箱逻辑 ---
        function openLightbox(src) {
            const lightbox = document.getElementById('lightbox');
            const img = document.getElementById('lightbox-img');
            
            img.src = src;
            lightbox.classList.add('active');
            document.body.style.overflow = 'hidden'; // 禁止背景滚动
        }

        function closeLightbox() {
            const lightbox = document.getElementById('lightbox');
            lightbox.classList.remove('active');
            document.body.style.overflow = 'auto'; // 恢复滚动
        }

        // --- 3. 获取照片逻辑 ---
        async function fetchPhotosFromGithub() {
            const loader = document.getElementById('api-loader');
            const grid = document.getElementById('photo-grid');
            loader.classList.remove('hidden');

            try {
                const apiUrl = `https://api.github.com/repos/${GITHUB_CONFIG.username}/${GITHUB_CONFIG.repo}/contents/${GITHUB_CONFIG.folder}`;
                const response = await fetch(apiUrl);
                
                if (!response.ok) throw new Error('无法获取图片列表');
                
                const files = await response.json();
                const imageExtensions = ['jpg', 'jpeg', 'png', 'gif', 'webp'];
                const photos = files.filter(file => {
                    const ext = file.name.split('.').pop().toLowerCase();
                    return imageExtensions.includes(ext);
                });

                renderPhotos(photos);
            } catch (error) {
                console.error('Error:', error);
                grid.innerHTML = `<p class="col-span-full text-center text-red-400">加载失败：${error.message}</p>`;
            } finally {
                loader.classList.add('hidden');
            }
        }

        function renderPhotos(photos) {
            const grid = document.getElementById('photo-grid');
            grid.innerHTML = '';

            photos.forEach(photo => {
                const card = document.createElement('div');
                card.className = 'photo-card glass-card';
                // 增加 onclick 事件触发灯箱，不再传递 caption
                card.onclick = () => openLightbox(photo.download_url);
                
                card.innerHTML = `
                    <img src="${photo.download_url}" alt="${photo.name}">
                    <div class="photo-overlay text-sm font-light">
                        ${photo.name}
                    </div>
                `;
                grid.appendChild(card);
            });
        }

        // --- 4. 背景动画 ---
        let scene, camera, renderer, particles;
        function initBackground() {
            scene = new THREE.Scene();
            camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
            camera.position.z = 5;
            renderer = new THREE.WebGLRenderer({ antialias: true, alpha: true });
            renderer.setSize(window.innerWidth, window.innerHeight);
            renderer.setPixelRatio(window.devicePixelRatio);
            document.getElementById('canvas-container').appendChild(renderer.domElement);
            const geometry = new THREE.BufferGeometry();
            const vertices = [];
            for (let i = 0; i < 2000; i++) {
                vertices.push(THREE.MathUtils.randFloatSpread(20), THREE.MathUtils.randFloatSpread(20), THREE.MathUtils.randFloatSpread(20));
            }
            geometry.setAttribute('position', new THREE.Float32BufferAttribute(vertices, 3));
            const material = new THREE.PointsMaterial({ color: 0x6366f1, size: 0.03, transparent: true, opacity: 0.6 });
            particles = new THREE.Points(geometry, material);
            scene.add(particles);
            window.addEventListener('resize', () => {
                camera.aspect = window.innerWidth / window.innerHeight;
                camera.updateProjectionMatrix();
                renderer.setSize(window.innerWidth, window.innerHeight);
            }, false);
            const animate = () => {
                requestAnimationFrame(animate);
                particles.rotation.y += 0.0005;
                renderer.render(scene, camera);
            };
            animate();
        }

        window.onload = () => {
            initBackground();
            fetchPhotosFromGithub();
        };
    </script>
</body>
</html>